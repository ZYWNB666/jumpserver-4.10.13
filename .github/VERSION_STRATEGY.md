# ğŸ“¦ é•œåƒç‰ˆæœ¬å·ç­–ç•¥

## é•œåƒåœ°å€

```
registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:[VERSION]
```

## ç‰ˆæœ¬å·æ ¼å¼

### 1ï¸âƒ£ æ­£å¼å‘å¸ƒç‰ˆæœ¬ï¼ˆæ¨èï¼‰

**è§¦å‘æ–¹å¼**: æ¨é€ Git æ ‡ç­¾

**æ ¼å¼**: ä½¿ç”¨ Git æ ‡ç­¾ä½œä¸ºç‰ˆæœ¬å·

**ç¤ºä¾‹**:
```bash
# æ¨é€æ ‡ç­¾
git tag v4.10.13
git push origin v4.10.13

# ç”Ÿæˆé•œåƒ
registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:v4.10.13
```

**é€‚ç”¨åœºæ™¯**: 
- âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- âœ… ç¨³å®šç‰ˆæœ¬å‘å¸ƒ
- âœ… ç‰ˆæœ¬ç®¡ç†å’Œå›æ»š

---

### 2ï¸âƒ£ å¼€å‘æµ‹è¯•ç‰ˆæœ¬ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

**è§¦å‘æ–¹å¼**: æ¨é€ä»£ç åˆ°åˆ†æ”¯ (main/master/dev)

**æ ¼å¼**: `v{åŸºç¡€ç‰ˆæœ¬}-{æ—¶é—´æˆ³}-{commit}`

**ç¤ºä¾‹**:
```bash
# æ¨é€ä»£ç 
git push origin main

# ç”Ÿæˆé•œåƒ
registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:v4.10.13-202512052106-a1b2c3d
```

**ç‰ˆæœ¬å·ç»„æˆ**:
- `v4.10.13`: åŸºç¡€ç‰ˆæœ¬å·ï¼ˆå¯¹åº” JumpServer ç‰ˆæœ¬ï¼‰
- `202512052106`: æ„å»ºæ—¶é—´æˆ³ï¼ˆ2025å¹´12æœˆ5æ—¥ 21:06ï¼‰
- `a1b2c3d`: Git commit çŸ­ hashï¼ˆ7ä½ï¼‰

**é€‚ç”¨åœºæ™¯**:
- âœ… å¼€å‘ç¯å¢ƒæµ‹è¯•
- âœ… æŒç»­é›†æˆæ„å»º
- âœ… é—®é¢˜æ’æŸ¥å’Œè¿½è¸ª

---

### 3ï¸âƒ£ æ‰‹åŠ¨è§¦å‘ç‰ˆæœ¬ï¼ˆè‡ªå®šä¹‰åç¼€ï¼‰

**è§¦å‘æ–¹å¼**: GitHub Actions æ‰‹åŠ¨è§¦å‘ + è¾“å…¥åç¼€

**æ ¼å¼**: `v{åŸºç¡€ç‰ˆæœ¬}-{æ—¶é—´æˆ³}-{commit}-{åç¼€}`

**ç¤ºä¾‹**:
```
è¾“å…¥åç¼€: beta
ç”Ÿæˆé•œåƒ: registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:v4.10.13-202512052106-a1b2c3d-beta
```

**é€‚ç”¨åœºæ™¯**:
- âœ… é¢„å‘å¸ƒç‰ˆæœ¬ï¼ˆalpha/beta/rcï¼‰
- âœ… ç‰¹æ€§åˆ†æ”¯æµ‹è¯•
- âœ… å®¢æˆ·ä¸“ç”¨ç‰ˆæœ¬

---

### 4ï¸âƒ£ Latest ç‰ˆæœ¬ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰

**æ ¼å¼**: `latest`

**ç¤ºä¾‹**:
```
registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:latest
```

**ç‰¹ç‚¹**:
- âœ… å§‹ç»ˆæŒ‡å‘æœ€æ–°æ„å»ºçš„é•œåƒ
- âœ… å¿«é€Ÿæµ‹è¯•æœ€æ–°åŠŸèƒ½
- âš ï¸ ä¸æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨

---

## ğŸ“‹ ç‰ˆæœ¬å·å¯¹ç…§è¡¨

| åœºæ™¯ | Git æ“ä½œ | é•œåƒç‰ˆæœ¬ | è¯´æ˜ |
|------|---------|---------|------|
| ç”Ÿäº§å‘å¸ƒ | `git tag v4.10.13` | `v4.10.13` | æ­£å¼ç‰ˆæœ¬ |
| çƒ­ä¿®å¤ | `git tag v4.10.13-hotfix.1` | `v4.10.13-hotfix.1` | ä¿®å¤ç‰ˆæœ¬ |
| å¼€å‘æµ‹è¯• | `git push origin dev` | `v4.10.13-202512052106-a1b2c3d` | å¼€å‘ç‰ˆæœ¬ |
| é¢„å‘å¸ƒ | æ‰‹åŠ¨è§¦å‘ + åç¼€ `beta` | `v4.10.13-202512052106-a1b2c3d-beta` | æµ‹è¯•ç‰ˆæœ¬ |
| æœ€æ–°ç‰ˆ | ä»»ä½•æ„å»º | `latest` | è‡ªåŠ¨æ›´æ–° |

---

## ğŸš€ æ¨èå·¥ä½œæµ

### åœºæ™¯1: æ—¥å¸¸å¼€å‘

```bash
# 1. ä¿®æ”¹ä»£ç 
vim apps/ops/api/job.py

# 2. æäº¤ä»£ç 
git add .
git commit -m "feat: add file server support"
git push origin dev

# 3. è‡ªåŠ¨è§¦å‘æ„å»º
# ç”Ÿæˆé•œåƒ: v4.10.13-202512052106-a1b2c3d

# 4. æ‹‰å–æµ‹è¯•
docker pull registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:v4.10.13-202512052106-a1b2c3d
```

### åœºæ™¯2: æ­£å¼å‘å¸ƒ

```bash
# 1. ç¡®è®¤ä»£ç å·²åˆå¹¶åˆ°ä¸»åˆ†æ”¯
git checkout main
git pull origin main

# 2. æ‰“æ ‡ç­¾
git tag v4.10.13
git push origin v4.10.13

# 3. è‡ªåŠ¨è§¦å‘æ„å»º
# ç”Ÿæˆé•œåƒ: v4.10.13

# 4. éƒ¨ç½²åˆ°ç”Ÿäº§
docker pull registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:v4.10.13
```

### åœºæ™¯3: æµ‹è¯•ç‰ˆæœ¬

```bash
# 1. åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘
# 2. è¾“å…¥åç¼€: beta
# 3. ç”Ÿæˆé•œåƒ: v4.10.13-202512052106-a1b2c3d-beta

# 4. æµ‹è¯•
docker pull registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:v4.10.13-202512052106-a1b2c3d-beta
```

---

## ğŸ“Œ ç‰ˆæœ¬å·è§„èŒƒå»ºè®®

### æ­£å¼ç‰ˆæœ¬æ ‡ç­¾è§„èŒƒ

```bash
# ä¸»ç‰ˆæœ¬å·ï¼ˆé‡å¤§æ›´æ–°ï¼‰
v5.0.0

# æ¬¡ç‰ˆæœ¬å·ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰
v4.11.0

# ä¿®è®¢ç‰ˆæœ¬å·ï¼ˆbug ä¿®å¤ï¼‰
v4.10.14

# çƒ­ä¿®å¤ç‰ˆæœ¬
v4.10.13-hotfix.1
v4.10.13-hotfix.2

# é¢„å‘å¸ƒç‰ˆæœ¬
v4.11.0-alpha.1
v4.11.0-beta.1
v4.11.0-rc.1
```

### ç‰ˆæœ¬å·å‘½åçº¦å®š

| åç¼€ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `-alpha.N` | å†…éƒ¨æµ‹è¯•ç‰ˆæœ¬ | `v4.11.0-alpha.1` |
| `-beta.N` | å…¬å¼€æµ‹è¯•ç‰ˆæœ¬ | `v4.11.0-beta.1` |
| `-rc.N` | å€™é€‰å‘å¸ƒç‰ˆæœ¬ | `v4.11.0-rc.1` |
| `-hotfix.N` | ç´§æ€¥ä¿®å¤ç‰ˆæœ¬ | `v4.10.13-hotfix.1` |
| `-custom` | è‡ªå®šä¹‰ç‰ˆæœ¬ | `v4.10.13-custom` |

---

## ğŸ” å¦‚ä½•æŸ¥æ‰¾é•œåƒ

### æ–¹å¼1: GitHub Actions é¡µé¢

1. è®¿é—® Actions é¡µé¢
2. æ‰¾åˆ°å¯¹åº”çš„æ„å»º
3. æŸ¥çœ‹æ„å»ºæ‘˜è¦ä¸­çš„é•œåƒç‰ˆæœ¬

### æ–¹å¼2: Git å†å²

```bash
# æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾
git tag -l

# æŸ¥çœ‹æœ€è¿‘çš„æ ‡ç­¾
git describe --tags

# æŸ¥çœ‹æŸæ¬¡æäº¤çš„çŸ­ hash
git log --oneline -1
```

### æ–¹å¼3: é˜¿é‡Œäº‘æ§åˆ¶å°

1. è®¿é—® https://cr.console.aliyun.com/
2. è¿›å…¥é•œåƒä»“åº“: `zywdockers/jmp-core`
3. æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ ‡ç­¾ç‰ˆæœ¬**
   ```bash
   docker pull registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:v4.10.13
   ```

2. **å¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨ latest**
   ```bash
   docker pull registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:latest
   ```

3. **é‡è¦ç‰ˆæœ¬æ‰“æ ‡ç­¾ä¿å­˜**
   ```bash
   git tag -a v4.10.13 -m "Release version 4.10.13"
   git push origin v4.10.13
   ```

### âŒ é¿å…åšæ³•

1. ~~ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ latest~~
   - Latest ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œå¯èƒ½å¯¼è‡´ä¸å¯é¢„æœŸçš„é—®é¢˜

2. ~~ä½¿ç”¨æ—¶é—´æˆ³ç‰ˆæœ¬åœ¨ç”Ÿäº§ç¯å¢ƒ~~
   - æ—¶é—´æˆ³ç‰ˆæœ¬éš¾ä»¥ç®¡ç†å’Œè¿½è¸ª

3. ~~åˆ é™¤å·²å‘å¸ƒçš„æ ‡ç­¾~~
   - ä¼šå¯¼è‡´ç‰ˆæœ¬æ··ä¹±

---

## ğŸ”„ ç‰ˆæœ¬å›æ»š

### å›æ»šåˆ°ç‰¹å®šç‰ˆæœ¬

```bash
# 1. æŸ¥çœ‹å†å²ç‰ˆæœ¬
git tag -l

# 2. æ‹‰å–æ—§ç‰ˆæœ¬é•œåƒ
docker pull registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:v4.10.12

# 3. é‡æ–°éƒ¨ç½²
docker stop jumpserver
docker rm jumpserver
docker run -d --name jumpserver \
  registry.cn-shanghai.aliyuncs.com/zywdockers/jmp-core:v4.10.12
```

### å›æ»šå¹¶é‡æ–°å‘å¸ƒ

```bash
# 1. å›é€€ä»£ç 
git checkout v4.10.12

# 2. æ‰“æ–°æ ‡ç­¾
git tag v4.10.13-rollback
git push origin v4.10.13-rollback

# 3. è‡ªåŠ¨æ„å»ºæ–°é•œåƒ
# é•œåƒ: v4.10.13-rollback
```

---

## ğŸ“Š ç‰ˆæœ¬ç®¡ç†å»ºè®®

### ä¿ç•™ç­–ç•¥

| ç‰ˆæœ¬ç±»å‹ | ä¿ç•™æ—¶é—´ | è¯´æ˜ |
|---------|---------|------|
| æ­£å¼ç‰ˆæœ¬ | æ°¸ä¹…ä¿ç•™ | v4.10.13, v4.11.0 ç­‰ |
| å¼€å‘ç‰ˆæœ¬ | 30 å¤© | v4.10.13-202512052106-a1b2c3d |
| Latest | è‡ªåŠ¨æ›´æ–° | å§‹ç»ˆä¿ç•™ |
| æµ‹è¯•ç‰ˆæœ¬ | 7 å¤© | *-beta, *-alpha ç­‰ |

### æ¸…ç†è„šæœ¬ç¤ºä¾‹

```bash
# æ¸…ç† 30 å¤©å‰çš„å¼€å‘ç‰ˆæœ¬ï¼ˆæ‰‹åŠ¨æ‰§è¡Œï¼‰
# éœ€è¦åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°æ“ä½œ
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•çŸ¥é“å½“å‰è¿è¡Œçš„æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Ÿ

```bash
# æŸ¥çœ‹å®¹å™¨é•œåƒ
docker inspect jumpserver | grep Image

# è¿›å…¥å®¹å™¨æŸ¥çœ‹
docker exec jumpserver cat /opt/jumpserver/apps/jumpserver/const.py | grep VERSION
```

### Q: ç‰ˆæœ¬å·å¤ªé•¿æ€ä¹ˆåŠï¼Ÿ

- æ­£å¼ç‰ˆæœ¬ä½¿ç”¨ç®€çŸ­çš„æ ‡ç­¾ï¼ˆå¦‚ v4.10.13ï¼‰
- å¼€å‘ç‰ˆæœ¬è™½ç„¶é•¿ï¼Œä½†åŒ…å«å®Œæ•´çš„è¿½è¸ªä¿¡æ¯

### Q: å¦‚ä½•å›ºå®šåŸºç¡€ç‰ˆæœ¬å·ï¼Ÿ

ä¿®æ”¹ `.github/workflows/build-and-push.yml` ä¸­çš„ `BASE_VERSION` å˜é‡

---

**ç‰ˆæœ¬å·ç­–ç•¥è¯´æ˜å®Œæˆï¼** ğŸ‰

