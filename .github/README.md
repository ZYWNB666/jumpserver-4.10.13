# GitHub Actions æ„å»ºé…ç½®

## ğŸ“¦ åŠŸèƒ½è¯´æ˜

æœ¬é…ç½®åªä¿ç•™äº† Docker é•œåƒæ„å»ºå’Œæ¨é€åŠŸèƒ½ï¼Œæ‰€æœ‰å…¶ä»– CI/CD åŠŸèƒ½å·²ç§»é™¤ã€‚

## ğŸš€ è‡ªåŠ¨æ„å»º

### è§¦å‘æ¡ä»¶

é•œåƒæ„å»ºä¼šåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨è§¦å‘ï¼š

1. **æ¨é€åˆ°ä¸»åˆ†æ”¯**
   - `main`
   - `master`
   - `dev`

2. **æ¨é€æ ‡ç­¾**
   - ä»»ä½•ä»¥ `v` å¼€å¤´çš„æ ‡ç­¾ï¼ˆå¦‚ `v4.10.13`ï¼‰

3. **æ‰‹åŠ¨è§¦å‘**
   - åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è¿è¡Œ

### é•œåƒå‘½åè§„åˆ™

æ„å»ºçš„é•œåƒä¼šè‡ªåŠ¨æ¨é€åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼š

- **æ—¶é—´æˆ³æ ‡ç­¾**: `registry.cn-shanghai.aliyuncs.com/zywdockers/images:jmp-core-YYYYMMDDHHmm`
  - ç¤ºä¾‹: `registry.cn-shanghai.aliyuncs.com/zywdockers/images:jmp-core-202512052106`

- **Latest æ ‡ç­¾**: `registry.cn-shanghai.aliyuncs.com/zywdockers/images:jmp-core-latest`
  - å§‹ç»ˆæŒ‡å‘æœ€æ–°æ„å»ºçš„é•œåƒ

## âš™ï¸ é…ç½®è¯´æ˜

### 1. é…ç½® Secrets

åœ¨ GitHub ä»“åº“çš„ **Settings â†’ Secrets and variables â†’ Actions** ä¸­æ·»åŠ ï¼š

| Secret åç§° | è¯´æ˜ | ç¤ºä¾‹ |
|------------|------|------|
| `ALIYUN_USERNAME` | é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ç”¨æˆ·å | `your-account@aliyun.com` |
| `ALIYUN_PASSWORD` | é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡å¯†ç  | `your-password` |

### 2. è·å–é˜¿é‡Œäº‘å‡­è¯

1. ç™»å½• [é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡æ§åˆ¶å°](https://cr.console.aliyun.com/)
2. è¿›å…¥ **å®ä¾‹åˆ—è¡¨** â†’ é€‰æ‹©ä¸ªäººå®ä¾‹æˆ–ä¼ä¸šå®ä¾‹
3. åœ¨å·¦ä¾§èœå•æ‰¾åˆ° **è®¿é—®å‡­è¯**
4. è®¾ç½®æˆ–æŸ¥çœ‹å›ºå®šå¯†ç 

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### è‡ªåŠ¨æ„å»ºï¼ˆæ¨èï¼‰

```bash
# 1. æäº¤ä»£ç åˆ°ä¸»åˆ†æ”¯
git add .
git commit -m "feat: add file server support"
git push origin main

# 2. æˆ–æ‰“æ ‡ç­¾è§¦å‘
git tag v4.10.13-custom
git push origin v4.10.13-custom

# 3. æŸ¥çœ‹æ„å»ºçŠ¶æ€
# è®¿é—®: https://github.com/ä½ çš„ç”¨æˆ·å/jumpserver-4.10.13/actions
```

### æ‰‹åŠ¨è§¦å‘æ„å»º

1. è®¿é—® GitHub Actions é¡µé¢
2. é€‰æ‹© **Build and Push JumpServer Image** workflow
3. ç‚¹å‡» **Run workflow**
4. ï¼ˆå¯é€‰ï¼‰è¾“å…¥è‡ªå®šä¹‰æ ‡ç­¾åç¼€
5. ç‚¹å‡» **Run workflow** å¼€å§‹æ„å»º

### æ‹‰å–é•œåƒ

```bash
# æ‹‰å–æŒ‡å®šæ—¶é—´æˆ³ç‰ˆæœ¬
docker pull registry.cn-shanghai.aliyuncs.com/zywdockers/images:jmp-core-202512052106

# æ‹‰å–æœ€æ–°ç‰ˆæœ¬
docker pull registry.cn-shanghai.aliyuncs.com/zywdockers/images:jmp-core-latest
```

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰é•œåƒæ ‡ç­¾

æ‰‹åŠ¨è§¦å‘æ—¶å¯ä»¥æ·»åŠ è‡ªå®šä¹‰åç¼€ï¼š

```
è¾“å…¥: beta
ç»“æœ: jmp-core-202512052106-beta
```

### ä¿®æ”¹é•œåƒä»“åº“

ç¼–è¾‘ `.github/workflows/build-and-push.yml`ï¼Œä¿®æ”¹ä»¥ä¸‹éƒ¨åˆ†ï¼š

```yaml
# ä¿®æ”¹é•œåƒä»“åº“åœ°å€
FULL_IMAGE="registry.cn-shanghai.aliyuncs.com/ä½ çš„å‘½åç©ºé—´/ä½ çš„ä»“åº“:${IMAGE_TAG}"
```

### å¤šæ¶æ„æ”¯æŒ

å¦‚éœ€æ”¯æŒ ARM64 æ¶æ„ï¼Œä¿®æ”¹ workflowï¼š

```yaml
platforms: linux/amd64,linux/arm64  # æ·»åŠ  arm64
```

## ğŸ“Š æ„å»ºäº§ç‰©

æ¯æ¬¡æˆåŠŸæ„å»ºåï¼Œä¼šç”Ÿæˆï¼š

1. **å¸¦æ—¶é—´æˆ³çš„é•œåƒ**: ç”¨äºç‰ˆæœ¬å›æº¯
2. **latest é•œåƒ**: ç”¨äºå¿«é€Ÿéƒ¨ç½²æœ€æ–°ç‰ˆæœ¬
3. **æ„å»ºç¼“å­˜**: åŠ é€Ÿåç»­æ„å»ºï¼ˆå­˜å‚¨åœ¨é•œåƒä»“åº“ï¼‰

## ğŸ› æ•…éšœæ’æŸ¥

### æ„å»ºå¤±è´¥

1. **ç™»å½•å¤±è´¥**
   - æ£€æŸ¥ Secrets é…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤é˜¿é‡Œäº‘å¯†ç æœªè¿‡æœŸ

2. **æ¨é€å¤±è´¥**
   - ç¡®è®¤é•œåƒä»“åº“å­˜åœ¨
   - æ£€æŸ¥å‘½åç©ºé—´æƒé™

3. **æ„å»ºè¶…æ—¶**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - æŸ¥çœ‹æ„å»ºæ—¥å¿—å®šä½é—®é¢˜

### æŸ¥çœ‹æ„å»ºæ—¥å¿—

1. è®¿é—® Actions é¡µé¢
2. ç‚¹å‡»å¯¹åº”çš„æ„å»ºä»»åŠ¡
3. å±•å¼€å¤±è´¥çš„æ­¥éª¤æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡æ–‡æ¡£](https://help.aliyun.com/product/60716.html)
- [GitHub Actions å®˜æ–¹æ–‡æ¡£](https://docs.github.com/actions)
- [Docker Buildx å¤šæ¶æ„æ„å»º](https://docs.docker.com/build/building/multi-platform/)

## ğŸ¯ æ³¨æ„äº‹é¡¹

1. âš ï¸ ç¡®ä¿é˜¿é‡Œäº‘é•œåƒä»“åº“å·²åˆ›å»ºå¹¶è®¾ç½®ä¸ºç§æœ‰
2. âš ï¸ å®šæœŸæ›´æ–° Secrets ä¸­çš„å¯†ç 
3. âš ï¸ æ„å»ºç¼“å­˜ä¼šå ç”¨é•œåƒä»“åº“ç©ºé—´ï¼Œå¯å®šæœŸæ¸…ç†
4. âš ï¸ æ—¶é—´æˆ³åŸºäº UTC+8 (ä¸­å›½æ ‡å‡†æ—¶é—´)

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·åœ¨ Issues ä¸­åé¦ˆã€‚

